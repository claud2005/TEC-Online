<!-- MENU LATERAL - DIREITA, PERSONALIZADO, COM BOTÃO DE FECHAR -->
<ion-menu contentId="main-content" side="end" type="overlay" class="custom-menu">
  <ion-header>
    <ion-toolbar color="tertiary">
      <ion-title>Menu</ion-title>
      <ion-buttons slot="end">
        <ion-button (click)="closeMenu()" aria-label="Fechar menu">
          <ion-icon name="close-circle-outline"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ion-header>
  <ion-content class="menu-content">
    <ion-list>
      <ion-item button (click)="navigateToAdministradores()">
        <ion-icon slot="start" name="shield-checkmark-outline"></ion-icon>
        <ion-label>Administradores</ion-label>
      </ion-item>
      <ion-item button (click)="navigateToClientes()">
        <ion-icon slot="start" name="people"></ion-icon>
        <ion-label>Clientes</ion-label>
      </ion-item>
      <ion-item button (click)="navigateToServicos()">
        <ion-icon slot="start" name="construct"></ion-icon>
        <ion-label>Serviços</ion-label>
      </ion-item>
      <ion-item button (click)="navigateToPerfil()">
        <ion-icon slot="start" name="person-circle"></ion-icon>
        <ion-label>Perfil</ion-label>
      </ion-item>
      <ion-item button (click)="navigateToCriarServicos()">
        <ion-icon slot="start" name="add-circle"></ion-icon>
        <ion-label>Criar Serviço</ion-label>
      </ion-item>

      <ion-item button (click)="navigateToAdicionarCliente()">
        <ion-icon slot="start" name="person-add"></ion-icon>
        <ion-label>Adicionar Cliente</ion-label>
      </ion-item>
    </ion-list>
  </ion-content>
</ion-menu>

<!-- TOPO OTIMIZADO PARA MOBILE -->
<ion-header>
  <ion-toolbar color="primary" class="custom-toolbar" style="display: flex; align-items: center;">
    <ion-buttons slot="start">
      <img src="assets/icon/logotipo.png" alt="Logo" class="header-logo" />
    </ion-buttons>
    <div class="header-title-container" style="flex: 1; text-align: center;">
      <span class="header-title">Olá, {{ utilizadorName || 'Carregando...' }}</span>
    </div>
    <ion-buttons slot="end">
      <ion-menu-button autoHide="false" menu="end" class="menu-button" aria-label="Abrir menu"></ion-menu-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<!-- CONTEÚDO PRINCIPAL -->
<ion-content id="main-content">
  <ion-grid>

    <!-- Barra de pesquisa -->
    <ion-row class="top-bar">
      <ion-col size="12">
        <ion-searchbar
          [(ngModel)]="searchQuery"
          (ionChange)="onSearchChange()"
          debounce="300"
          placeholder="Pesquisar serviços, marcas, modelos..."
          aria-label="Pesquisar serviços, marcas, modelos"
        >
        </ion-searchbar>
      </ion-col>
    </ion-row>

    <!-- Filtros (Dropdown) -->
    <ion-row class="filter-row">
      <ion-col size="12" size-md="6" size-lg="4">
        <ion-select
          placeholder="Filtrar"
          [(ngModel)]="selectedFilter"
          (ionChange)="onSelectedFilterChange()"
          interface="popover"
          aria-label="Filtrar serviços"
        >
          <ion-select-option [value]="-1">Sem filtro</ion-select-option>
          <ion-select-option [value]="0">Hoje</ion-select-option>
          <ion-select-option [value]="7">Últimos 7 dias</ion-select-option>
          <ion-select-option [value]="30">Últimos 30 dias</ion-select-option>
          <ion-select-option value="aberto">Aberto</ion-select-option>
          <ion-select-option value="fechado">Fechado</ion-select-option>
        </ion-select>
      </ion-col>
    </ion-row>

    <!-- Lista de serviços -->
    <ion-row *ngIf="filteredServices.length > 0; else noResults">
      <ion-col size="12" *ngFor="let servico of filteredServices">
        <ion-card class="service-card">
          <ion-card-header>
            <ion-card-title>{{ servico.nomeCompletoCliente }}</ion-card-title>
            <ion-card-subtitle>
              {{ formatDate(servico.dataServico) }} | {{ servico.horaServico }}
            </ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <p><strong>Problema:</strong> {{ servico.problemaCliente }}</p>
            <p><strong>Modelo:</strong> {{ servico.marcaAparelho }} {{ servico.modeloAparelho }}</p>
            <p><strong>Observações:</strong> {{ servico.observacoes }}</p>

            <!-- Botões de status -->
            <div class="status-toggle">
              <ion-button
                fill="outline"
                shape="round"
                [class.active]="servico.status === 'aberto'"
                color="success"
                (click)="alterarStatus(servico, 'aberto')"
                aria-pressed="{{ servico.status === 'aberto' ? 'true' : 'false' }}"
              >
                Aberto
              </ion-button>

              <ion-button
                fill="outline"
                shape="round"
                [class.active]="servico.status === 'fechado'"
                color="danger"
                (click)="alterarStatus(servico, 'fechado')"
                aria-pressed="{{ servico.status === 'fechado' ? 'true' : 'false' }}"
              >
                Fechado
              </ion-button>
            </div>

            <ion-button
              expand="block"
              fill="solid"
              color="primary"
              (click)="editarServico(servico.id)"
              aria-label="Editar serviço {{ servico.nomeCompletoCliente }}"
            >
              Editar Serviço
            </ion-button>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>

    <ng-template #noResults>
      <ion-col size="12" class="no-results-message">
        <p>Nenhum serviço encontrado.</p>
      </ion-col>
    </ng-template>

  </ion-grid>
</ion-content>
