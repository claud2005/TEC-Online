"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8546],{8546:(v,m,s)=>{s.r(m),s.d(m,{EditarPerfilPageModule:()=>M});var u=s(177),c=s(4341),a=s(4742),p=s(6960),g=s(5312),e=s(4438),h=s(1626);function P(i,l){1&i&&(e.j41(0,"ion-note",15),e.EFF(1," O nome completo \xe9 obrigat\xf3rio. "),e.k0s())}function b(i,l){1&i&&(e.j41(0,"ion-note",15),e.EFF(1," O nome de utilizador \xe9 obrigat\xf3rio. "),e.k0s())}const x=[{path:"",component:(()=>{var i;class l{constructor(t,o){this.router=t,this.http=o,this.perfil={fullName:"",username:"",profilePicture:""},this.isLoading=!1,this.token=null,this.selectedFile=null}ngOnInit(){if(this.token=localStorage.getItem("token"),console.log("Token recuperado do localStorage:",this.token),!this.token)return console.warn("Token n\xe3o encontrado! Redirecionando para a p\xe1gina inicial..."),void this.router.navigate(["/home"]);this.carregarPerfil()}carregarPerfil(){this.isLoading=!0,this.http.get(`${g.c.api_url}/api/profile`,{headers:{Authorization:`Bearer ${this.token}`}}).subscribe(t=>{this.perfil=t,this.isLoading=!1},t=>{console.error("Erro ao carregar perfil:",t),(401===t.status||403===t.status)&&this.logout(),this.isLoading=!1})}salvarPerfil(){if(!this.perfil.fullName||!this.perfil.username)return void alert("Por favor, preencha todos os campos obrigat\xf3rios!");this.isLoading=!0;const t=new FormData;t.append("fullName",this.perfil.fullName),t.append("username",this.perfil.username),this.selectedFile?(console.log("Adicionando a foto ao FormData:",this.selectedFile),t.append("profilePicture",this.selectedFile,this.selectedFile.name)):console.log("Nenhuma foto selecionada");const o=localStorage.getItem("token");if(!o)return alert("Voc\xea precisa estar autenticado para atualizar seu perfil!"),void this.router.navigate(["/login"]);console.log("Enviando perfil:",t),this.http.put(`${g.c.api_url}/api/profile`,t,{headers:{Authorization:`Bearer ${o}`}}).subscribe(n=>{console.log("Perfil atualizado com sucesso:",n),alert("Perfil atualizado com sucesso!"),n.profilePicture&&(this.perfil.profilePicture=`${g.c.api_url}/`+n.profilePicture),localStorage.setItem("perfil",JSON.stringify(this.perfil)),this.router.navigate(["/perfil"])},n=>{console.error("Erro ao atualizar perfil:",n),alert("Erro ao atualizar perfil. Tente novamente."),(401===n.status||403===n.status)&&this.logout(),this.isLoading=!1})}alterarFoto(){const t=document.getElementById("fileInput");t&&t.click()}onFileSelected(t){if(!t.target)return;const o=t.target;if(o.files&&o.files[0]){if(this.selectedFile=o.files[0],console.log("Tipo de arquivo selecionado:",this.selectedFile.type),!this.selectedFile.type.startsWith("image/"))return void alert("Por favor, selecione um arquivo de imagem.");const n=2097152;if(console.log("Tamanho do arquivo:",this.selectedFile.size),this.selectedFile.size>n)return void alert("O arquivo \xe9 muito grande. O tamanho m\xe1ximo permitido \xe9 2MB.");const f=new FileReader;f.onload=r=>{console.log("Imagem carregada com sucesso:",r.target.result),this.perfil.profilePicture=r.target.result},f.readAsDataURL(this.selectedFile)}}logout(){localStorage.removeItem("token"),localStorage.removeItem("perfil"),this.router.navigate(["/home"])}voltar(){this.router.navigate(["/perfil"])}}return(i=l).\u0275fac=function(t){return new(t||i)(e.rXU(p.Ix),e.rXU(h.Qq))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-editar-perfil"]],decls:25,vars:5,consts:[["form","ngForm"],["aria-label","Voltar",1,"back-button",3,"click"],["name","arrow-back-outline"],[1,"content-wrapper"],[1,"center-container"],[3,"ngSubmit"],[1,"profile-picture",3,"click"],["alt","Foto de Perfil",3,"src"],["expand","block","aria-label","Alterar Foto",1,"alterar-foto",3,"click"],["type","file","id","fileInput","accept","image/*","hidden","",3,"change"],["position","floating"],["name","fullName","required","","minlength","3",3,"ngModelChange","ngModel"],["color","danger",4,"ngIf"],["name","username","required","","minlength","3",3,"ngModelChange","ngModel"],["expand","full","type","submit"],["color","danger"]],template:function(t,o){if(1&t){const n=e.RV6();e.j41(0,"ion-content")(1,"button",1),e.bIt("click",function(){return e.eBV(n),e.Njj(o.voltar())}),e.nrm(2,"ion-icon",2),e.EFF(3," Voltar "),e.k0s(),e.j41(4,"div",3)(5,"div",4)(6,"form",5,0),e.bIt("ngSubmit",function(){return e.eBV(n),e.Njj(o.salvarPerfil())}),e.j41(8,"div",6),e.bIt("click",function(){return e.eBV(n),e.Njj(o.alterarFoto())}),e.nrm(9,"img",7),e.k0s(),e.j41(10,"ion-button",8),e.bIt("click",function(){return e.eBV(n),e.Njj(o.alterarFoto())}),e.EFF(11," Alterar Foto "),e.k0s(),e.j41(12,"input",9),e.bIt("change",function(r){return e.eBV(n),e.Njj(o.onFileSelected(r))}),e.k0s(),e.j41(13,"ion-item")(14,"ion-label",10),e.EFF(15,"Nome Completo:"),e.k0s(),e.j41(16,"ion-input",11),e.mxI("ngModelChange",function(r){return e.eBV(n),e.DH7(o.perfil.fullName,r)||(o.perfil.fullName=r),e.Njj(r)}),e.k0s()(),e.DNE(17,P,2,0,"ion-note",12),e.j41(18,"ion-item")(19,"ion-label",10),e.EFF(20,"Nome de Utilizador:"),e.k0s(),e.j41(21,"ion-input",13),e.mxI("ngModelChange",function(r){return e.eBV(n),e.DH7(o.perfil.username,r)||(o.perfil.username=r),e.Njj(r)}),e.k0s()(),e.DNE(22,b,2,0,"ion-note",12),e.j41(23,"ion-button",14),e.EFF(24," Salvar "),e.k0s()()()()()}if(2&t){const n=e.sdS(7);e.R7$(9),e.Y8G("src",o.perfil.profilePicture||"assets/img/default-profile.png",e.B4B),e.R7$(7),e.R50("ngModel",o.perfil.fullName),e.R7$(),e.Y8G("ngIf",!o.perfil.fullName&&n.submitted),e.R7$(4),e.R50("ngModel",o.perfil.username),e.R7$(),e.Y8G("ngIf",!o.perfil.username&&n.submitted)}},dependencies:[a.bv,a.Jm,a.W9,a.iq,a.$w,a.uz,a.he,a.JI,a.Gw,u.MD,u.bT,c.YN,c.qT,c.BC,c.cb,c.YS,c.xh,c.vS,c.cV],styles:['@charset "UTF-8";ion-content[_ngcontent-%COMP%]{--background: linear-gradient(135deg, #264653, #4b0082);padding:20px;position:relative;color:#f1f1f1;font-family:Segoe UI,sans-serif}.content-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;min-height:100vh;width:100%;padding:20px}.center-container[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:30px 20px;max-width:500px;width:100%;box-shadow:0 10px 30px #0000004d;text-align:center;color:#333;z-index:1}.profile-picture[_ngcontent-%COMP%]{width:140px;height:140px;border-radius:50%;background:#eee;overflow:hidden;margin:0 auto 20px;box-shadow:0 6px 20px #0003;cursor:pointer;transition:transform .3s ease}.profile-picture[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.profile-picture[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.alterar-foto[_ngcontent-%COMP%]{--background: #facc15;--color: #1e293b;font-weight:700;font-size:15px;margin-bottom:20px;border-radius:10px}ion-item[_ngcontent-%COMP%]{margin-bottom:16px;--highlight-color-focused: #facc15}ion-label[_ngcontent-%COMP%]{color:#666}ion-input[_ngcontent-%COMP%]{color:#333;font-size:16px}ion-note[color=danger][_ngcontent-%COMP%]{font-size:13px;margin-top:-12px;margin-bottom:10px;display:block;text-align:left}ion-button[type=submit][_ngcontent-%COMP%]{--background: linear-gradient(135deg, #34d399, #059669);--color: #ffffff;font-size:16px;font-weight:700;border-radius:10px;padding:14px;margin-top:10px;transition:filter .3s ease,transform .3s ease}ion-button[type=submit][_ngcontent-%COMP%]:hover{filter:brightness(1.1);transform:scale(1.03)}.back-button[_ngcontent-%COMP%]{position:fixed;top:20px;left:20px;background:none;color:#facc15;font-size:16px;border:none;display:flex;align-items:center;gap:6px;cursor:pointer;z-index:1000;transition:opacity .3s ease}.back-button[_ngcontent-%COMP%]:hover{opacity:.7}@media (max-width: 600px){.center-container[_ngcontent-%COMP%]{padding:20px;width:90%}.profile-picture[_ngcontent-%COMP%]{width:100px;height:100px}ion-button[_ngcontent-%COMP%]{font-size:14px;padding:12px}.alterar-foto[_ngcontent-%COMP%]{font-size:14px;padding:12px}}']}),l})()}];let F=(()=>{var i;class l{}return(i=l).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[p.iI.forChild(x),p.iI]}),l})(),M=(()=>{var i;class l{}return(i=l).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[u.MD,c.YN,a.bv,F]}),l})()}}]);