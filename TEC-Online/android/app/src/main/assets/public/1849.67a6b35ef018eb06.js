"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1849],{1849:(v,g,r)=>{r.r(g),r.d(g,{PerfilPageModule:()=>C});var d=r(177),p=r(4341),s=r(4742),c=r(9522),m=r(467),f=r(3114),e=r(4438),P=r(3656),b=r(1626);let h=(()=>{var n;class l{constructor(t,o,i){this.platform=t,this.router=o,this.http=i,this.fotoPerfil="assets/img/default-profile.png",this.nomeCompleto="Carregando...",this.nomeUtilizador="Carregando...",this.token=null,this.isWeb=!this.platform.is("hybrid")}ngOnInit(){this.token=localStorage.getItem("token"),console.log("Token encontrado:",this.token),this.token?this.carregarDadosPerfil():(console.warn("Token n\xe3o encontrado! Redirecionando para login."),this.router.navigate(["/home"]))}carregarDadosPerfil(){console.log("Buscando perfil do usu\xe1rio..."),this.http.get("http://localhost:3000/api/users/perfil",{headers:{Authorization:`Bearer ${this.token}`}}).subscribe(t=>{console.log("Dados do perfil recebidos:",t),t?(this.nomeCompleto=t.name||"Nome n\xe3o dispon\xedvel",this.nomeUtilizador=t.username||"Usu\xe1rio n\xe3o dispon\xedvel",this.fotoPerfil=t.profilePicture||this.fotoPerfil):console.error("Erro: Nenhum dado recebido.")},t=>{console.error("Erro ao carregar perfil:",t)})}alterarFoto(){var t=this;return(0,m.A)(function*(){var o;if(t.isWeb)null===(o=document.getElementById("fileInput"))||void 0===o||o.click();else try{const i=yield f.i7.getPhoto({quality:90,allowEditing:!1,resultType:f.LK.DataUrl,source:f.ru.Prompt});i.dataUrl&&(t.fotoPerfil=i.dataUrl)}catch(i){console.error("Erro ao capturar imagem:",i)}})()}onFileSelected(t){const o=t.target.files[0];if(o){const i=new FileReader;i.onload=u=>{this.fotoPerfil=u.target.result},i.readAsDataURL(o)}}salvarPerfil(){this.http.put("http://localhost:3000/api/users/profile",{name:this.nomeCompleto,username:this.nomeUtilizador,profilePicture:this.fotoPerfil},{headers:{Authorization:`Bearer ${this.token}`}}).subscribe(o=>{console.log("Perfil atualizado com sucesso:",o),alert("Perfil atualizado com sucesso!")},o=>{console.error("Erro ao atualizar perfil:",o)})}logout(){localStorage.removeItem("token"),this.router.navigate(["/home"])}editarPerfil(){this.router.navigate(["/editar-perfil"])}}return(n=l).\u0275fac=function(t){return new(t||n)(e.rXU(P.OD),e.rXU(c.Ix),e.rXU(b.Qq))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-perfil"]],decls:23,vars:3,consts:[[1,"profile-container"],[1,"profile-title"],[1,"profile-picture",3,"click"],["alt","Foto de Perfil",3,"src"],["expand","block","aria-label","Alterar Foto",1,"small-button",3,"click"],["type","file","id","fileInput","accept","image/*","hidden","",3,"change"],[1,"user-info"],[1,"button-group"],["expand","block","fill","outline","aria-label","Editar Perfil",1,"small-button",3,"click"],["expand","block","color","danger","aria-label","Logout",1,"small-button",3,"click"]],template:function(t,o){1&t&&(e.j41(0,"ion-content")(1,"div",0)(2,"h2",1),e.EFF(3,"Perfil"),e.k0s(),e.j41(4,"div",2),e.bIt("click",function(){return o.alterarFoto()}),e.nrm(5,"img",3),e.k0s(),e.j41(6,"ion-button",4),e.bIt("click",function(){return o.alterarFoto()}),e.EFF(7," Alterar Foto "),e.k0s(),e.j41(8,"input",5),e.bIt("change",function(u){return o.onFileSelected(u)}),e.k0s(),e.j41(9,"div",6)(10,"p")(11,"strong"),e.EFF(12,"Nome Completo:"),e.k0s(),e.EFF(13),e.k0s(),e.j41(14,"p")(15,"strong"),e.EFF(16,"Nome de Utilizador:"),e.k0s(),e.EFF(17),e.k0s()(),e.j41(18,"div",7)(19,"ion-button",8),e.bIt("click",function(){return o.editarPerfil()}),e.EFF(20," Editar Perfil "),e.k0s(),e.j41(21,"ion-button",9),e.bIt("click",function(){return o.logout()}),e.EFF(22," Logout "),e.k0s()()()()),2&t&&(e.R7$(5),e.Y8G("src",o.fotoPerfil||"assets/img/default-profile.png",e.B4B),e.R7$(8),e.SpI(" ",o.nomeCompleto,""),e.R7$(4),e.SpI(" ",o.nomeUtilizador,""))},dependencies:[s.bv,s.Jm,s.W9,d.MD,p.YN],styles:['@charset "UTF-8";ion-content[_ngcontent-%COMP%]{--background: linear-gradient(135deg, #4B0082, #0000CD);padding:20px;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh}.profile-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;height:80vh}.profile-title[_ngcontent-%COMP%]{font-size:28px;font-weight:700;color:#fff;margin-bottom:20px}.user-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:22px;color:#fff;margin:10px 0}.button-group[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{width:250px;font-size:18px;margin-top:10px}ion-header[_ngcontent-%COMP%]{--background: transparent;box-shadow:none;height:80px}ion-toolbar[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100%}.user-title[_ngcontent-%COMP%]{font-size:22px;font-weight:700;color:#fff;text-align:center}.logo[_ngcontent-%COMP%]{width:50px;height:auto}.profile-picture-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-top:20px}.profile-picture[_ngcontent-%COMP%]{width:120px;height:120px;border-radius:50%;background:#ddd;display:flex;justify-content:center;align-items:center;overflow:hidden;box-shadow:0 4px 6px #0003}ion-button[_ngcontent-%COMP%]{width:90%;max-width:350px;margin:10px 0;font-size:18px}.edit-button[_ngcontent-%COMP%]{--background: #007bff;--color: white;font-size:18px}.logout-button[_ngcontent-%COMP%]{--background: #dc3545;--color: white;font-size:18px}.profile-info[_ngcontent-%COMP%]{text-align:center;font-size:20px;color:#fff;font-weight:700;margin-top:10px}ion-footer[_ngcontent-%COMP%]{--background: #4B0082;box-shadow:0 -2px 10px #0000001a;position:fixed;bottom:0;width:100%;height:60px}ion-toolbar[_ngcontent-%COMP%]{display:flex;justify-content:space-around;align-items:center}ion-button.footer-button[_ngcontent-%COMP%]{--background: transparent;--color: #ffffff;font-size:16px}.profile-picture[_ngcontent-%COMP%]{width:150px;height:150px;border-radius:50%;background:#ddd;display:flex;justify-content:center;align-items:center;overflow:hidden;box-shadow:0 4px 6px #0003;cursor:pointer}.profile-picture[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;border-radius:50%}']}),l})();const x=[{path:"",component:h}];let k=(()=>{var n;class l{}return(n=l).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[c.iI.forChild(x),c.iI]}),l})(),C=(()=>{var n;class l{}return(n=l).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[d.MD,p.YN,s.bv,k,h]}),l})()}}]);